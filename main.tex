% press command+option+B to build, or change "Auto Build: Run" in Settings.

\documentclass{book}

\usepackage{xeCJK}
\usepackage{geometry}
\usepackage{titlesec}
\usepackage{bm}
\usepackage{underlin}
\usepackage{wrapfig}
\usepackage{caption}
\usepackage{graphicx}
\usepackage{pdfpages}
\usepackage{multirow}%表格合并行列单元格

% 分栏并浮动图片
\usepackage{float}
\usepackage{multicol}
\usepackage[none]{hyphenat}
\usepackage{appendix}

% 数学
\usepackage{unicode-math}%正体希腊字母
\usepackage{mathrsfs}
\usepackage{amsfonts}

% 设置图书版式
\usepackage{marginnote}%侧栏
\usepackage{fancyhdr}%页眉页脚页码
\usepackage{indentfirst}%首段空两格
\usepackage{mdframed}%加阴影
\usepackage{color}%特殊字体颜色
\usepackage{setspace}%行距

\usepackage{hyperref}%所有网页用超链接同步挂靠
\usepackage{xpatch}%设置verbatim前后间距

%行号
\usepackage{lineno}

\def\codereplace#1{%代码中的可替换部分
    \textsl{⟨#1⟩}}
    % \textsl{#1}}

\def\wz#1{%网址
    {\ttfamily #1}}

\def\jz#1{%原书脚注
    \footnote{#1}
}

\def\yz#1{%译注
    \footnote{\textsl{译注：}#1}
}

\def\dm#1{%代码
    \texttt{#1}}

\def\dmh#1{%代码行
    {\xeCJKsetup{CJKecglue={\hskip 0pt}}
    \char"258E \texttt{#1}}
}

\def\celan#1{%侧栏TODO三角形方向
$\blacktriangleright$
\marginpar{
        $\blacktriangleleft$\textsf{#1}
    }
}

\definecolor{LightPink}{RGB}{230,173,173}
\newenvironment{exclamation}[1][!]%原书的圆圈感叹号
{
    \begin{mdframed}[backgroundcolor=LightPink,hidealllines=true]
        {\textcircled{\scriptsize #1}} \quad
        \sffamily
}{      
    \rmfamily
    \end{mdframed}
}

\definecolor{LightBlue}{RGB}{173,216,230}
\newenvironment{ii}[1][i]%原书的圆圈i
{
    \begin{mdframed}[backgroundcolor=LightBlue,hidealllines=true]
        {\textcircled{\scriptsize #1}} \quad
        \sffamily
}{      
    \rmfamily
    \end{mdframed}
}

\newenvironment{dmd}{%代码段
    \xeCJKsetup{CJKecglue={\hskip 0pt}}
    \vspace{0.5em}
    \ttfamily
    \setlength{\parindent}{0pt}
}{
    \rmfamily
    \vspace{0.5em}
}

%代码清单
\newenvironment{codelist}[2][TODO代码清单序号]{
    \setlength{\parindent}{0pt}
    \begin{mdframed}
        \textbf{清单 #1}
        \begin{mdframed}[backgroundcolor=lightgray,hidealllines=true]
            #2 
    \end{mdframed}
}
{
    \end{mdframed}
}

%字体
\setCJKmainfont[
    BoldFont={NotoSerifCJKsc-Bold},
    ItalicFont={Kai},
    SlantedFont={STFangsong},
    ]
    {STSongti-SC-Regular}
\setCJKsansfont[
    ItalicFont={SmileySans-Oblique},
    SlantedFont={STFangsong}]
    {NotoSansCJKsc-DemiLight}
\setCJKmonofont[
    % ItalicFont={SmileySans-Oblique},
    SlantedFont={STFangsong}]
    {STYuanti-SC-Regular}
\setmonofont[
    ItalicFont={LMMono10-Italic},
    SlantedFont={SFMono-RegularItalic}
    ]
    {LMMono10-Regular}

%特殊字符的字体显示
\xeCJKsetcharclass{"2580}{"259F}{1}
\xeCJKsetcharclass{"27E8}{"27E9}{1}
\xeCJKsetup{AutoFallBack=true}
\setCJKfallbackfamilyfont{\CJKrmdefault}{STIXTwoMath-Regular}

\definecolor{MediumBlue}{RGB}{0,0,205}
%引用颜色
\hypersetup{
    colorlinks = true,
    linkcolor = MediumBlue
}

\title{关于\LaTeX 的那些你想知道却从不敢问的问题\\{\small 或者说，如何在不会使用\LaTeX 的情况下使用\LaTeX }\\~\\Tout ce que vous avez toujours voulu savoir sur \LaTeX \ sans jamais oser le demander\\{\small Ou comment utiliser \LaTeX \ quand on n'y connaît goutte}\\~\\ ver. 1.5}
\author{Vincent Lozano 著}

\begin{document}
\maketitle
\tableofcontents
\mainmatter

%正文版式
\newgeometry{
    % inner = 2cm, outer = 4cm,
    % top = 2.5cm, bottom=2.5cm, 
    marginparwidth = 2cm, marginparsep = 0.5cm,
    % includeheadfoot
}
\pagestyle{fancy}
\fancyhead{} 
\fancyhead[RO,LE]{\thepage}
\fancyfoot{}

\setstretch{1.2}
\xpretocmd\verbatim{
    \setlength{\topsep}{0pt}
    \setlength{\partopsep}{0pt}}{}{\fail}

\input{introduction.tex}
\input{chapitre1.tex}
\input{chapitre2.tex}
\input{chapitre3.tex}
% \begin{appendices}
%     \section{附录}
% \end{appendices}
\end{document}