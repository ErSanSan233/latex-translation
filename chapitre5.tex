\chapter{图像}

\begin{quote}
    不可为自己雕刻偶像，也不可作什么形像……不可跪拜那些像，也不可事奉它。——《圣经·申命记》5:8\yz{
        本句实际上拼合了《圣经·申命记》的5:8和5:9。
    }
\end{quote}

今天，在文档中插入画、照片或其他类型的图像看起来稀松平常，这是由于印刷技术的性能日渐强大、运行日渐稳定。但我们需要在20世纪80年代，也就是\TeX 仍在发展的背景下去看问题。在那个年代，打印机刚刚出现，个体无法接触到具有高质量打印能力的设备。然而，很多打印的解决方案将会诞生，其中的大部分都会基于PostScript语言，因为使用PostScript已经成为了\emph{事实上的}标准做法。

围绕\LaTeX ，有很多在文档中插入图像的解决方案。我们会注意到，其中的一些使用了\textsf{metafont}（管理\LaTeX 字体的实用工具），一些编写了环境\dm{picture}，还有一些使用了PIC\TeX 的代码。此处不会介绍这些解决方案，因为我们认为它们有些难以上手。即便如此，你还是需要知道这些解决方案的存在。本书采纳的操作图像的方式是：在\LaTeX 源码中插入封装了相关内容的PostScript格式文件。这种文件可以使用\textsf{xfig}、\textsf{gnuplot}、\textsf{gimp}等绘图软件生成。

\section{开胃小菜}

了解一下用于画线的指令\verb|\rule|多少有些用处：

\begin{dmd}
\backslash rule[\codereplace{纵向位置}]\{\codereplace{长度}\}\{\codereplace{宽度}\}
\end{dmd}

其中\codereplace{纵向位置}可以根据需要在竖直方向上平移线，另外两个参数足以描述线的形态：

\begin{codelist}[5.1]{
    这些都是“线”：
\begin{center}
    \rule[1ex]{1mm}{5mm}
    \quad\rule{1in}{0.4pt}
    \quad\rule[-0.5em]{1em}{1em}
\end{center}
}\begin{verbatim}
这些都是“线”：
\begin{center}
    \rule[1ex]{1mm}{5mm}
    \quad\rule{1in}{0.4pt}
    \quad\rule[-0.5em]{1em}{1em}
\end{center}
\end{verbatim}
\end{codelist}

\section{图像文件的格式}

为了在文档中包含图像，需要插入\emph{文件}。\LaTeX 的配置允许其夹带PS（即PostScript）和EPS（即Encapsuled PostScript）类型的文件，至于要插入的文件是由什么软件生成的，\LaTeX 并不关心。你如果认为PostScript格式有诸多限制，那么需要认识到以下事实。

\begin{itemize}
    \item 所有\emph{合格}的“矢量”绘图软件都具有将图表导出为EPS格式文件的功能。对于印刷设备，这种格式已经成为标准。
    \item 所有图片都可以转换为EPS格式。在UNIX系统中，可以借助程序\textsf{convert}完成这一操作\jz{
        如果你的系统中没有这个程序，请查找“ImageMagick”套件来获取它。
    }。我们也可以使用软件\textsf{gimp}（一款自由软件，可以用于修图和创建数字图片）完成这一操作，它也适用于其他操作系统。
\end{itemize}

\section{包\textsf{graphicx}}

\LaTeX ，或者说\TeX ，在最初的设想中并不以操作图像（图片、图画等）为目的。基于此，大量扩展被提出，但它们都不是必需的，也不能真正独立于操作系统。

\subsection{标准}

目前，\LaTeX 设计师似乎同意将\emph{图像的}扩展统一起来。1994年年末，两个扩展走入了人们的视野：

\begin{itemize}
    \item \textsf{graphics}，作为“标准”扩展；
    \item \textsf{graphicx}，作为“升级版”扩展。
\end{itemize}

此处选择介绍\textsf{graphicx}。需要理解，即使该扩展单界面独立于操作系统，用于管理不同种类图像文件的那部分代码也依赖底层系统。这样一来，就需要指明包的\emph{驱动（driver）}。在不同平台上\jz{
    其中可以注意到：对于UNIX，有\textsf{xdvi}和\textsf{dvips}；对于macOS，有\textsf{texture}和Oz\TeX ；对于Windows，有em\TeX 和\textsf{dviwin}。
}，已有的驱动对应\TeX 识别到的实现。在UNIX中，通常使用\textsf{dvips}。它在\TeX 的发布版中默认选用，如此一来，以下指令足以调用扩展\textsf{graphicx}：

\begin{dmd}
\backslash usepackage\{graphicx\}
\end{dmd}

此时，使用以下指令就能在文档中包含图画或图片：

\begin{dmd}
\backslash includegraphics[\codereplace{选项}]\{\codereplace{文件}\}
\end{dmd}

其中，\codereplace{文件}即包含图片的文件，\codereplace{选项}可以是以逗号隔开的一系列配置。\verb|\includegraphics|不会创建特殊的版式，只会在文本中插入一个包含图像的字盒：

\begin{codelist}[5.2]{
    前前
\includegraphics{img/punch_small}
后后。
}\begin{verbatim}
前前
\includegraphics{punch}
后后。
\end{verbatim}
\end{codelist}

\begin{exclamation}
    为了确保源代码的便携性、确保代码能够再不同格式下插入图像文件，有必要\emph{在指令}\dm{\backslash includegraphics}\emph{中不指定文件的扩展名}
\end{exclamation}

通常来说，我们会将\verb|\includegraphics|与环境\dm{figure}\celan{\S 2.7}结合使用。例如，图\ref{fig:5.1}依靠以下代码生成：

\begin{figure}
    \centering\includegraphics[width=5cm]{img/punch}
    \caption{罗伯特（酒后版）}
    \label{fig:5.1}
\end{figure}

\begin{dmd}
\begin{verbatim}
\begin{figure}
    \centering\includegraphics[width=5cm]{punch}
    \caption{罗伯特（酒后版）}
    \label{fig-exemple}
\end{figure}
\end{verbatim}
\end{dmd}

\begin{exclamation}
注意，环境\dm{figure}可以使图像在页面中“浮动”，而指令\verb|\includegraphics|无法做到这一点。为了防止有人漏掉这一点，再重复一遍：
\begin{center}
    \bfseries
    环境\dm{figure}可以确保\\
    图像在页面中“浮动”。\\
    这不是由指令\dm{\backslash includegraphics}\\
    来确保的。
\end{center}
\end{exclamation}

\subsection{选项}

包\textsf{graphicx}中含有若干选项，可以用于控制图像的插入过程。此处介绍其中一组最实用的选项。

\subsubsection{更改比例}

有三种调整图像尺寸的方式：

\begin{itemize}
    \item \dm{scale=}\codereplace{比例}，其中\codereplace{比例}用于整体调整图片的大小，可以为正值或负值。
    \item \dm{width=}\codereplace{尺寸}，可以指定图片的宽度；
    \item \dm{height=}\codereplace{尺寸}，可以指定图片的高度。
\end{itemize}

\begin{codelist}[]{
    \begin{center} 
    \includegraphics[scale=0.2]{img/magma}\\
    \includegraphics[width=8.5mm]{img/magma}\\
    \includegraphics[width=2cm,
                    height=3mm]{img/magma}
    \end{center}
}\begin{verbatim}
\begin{center}
  \includegraphics[scale=0.2]{magma}\\
  \includegraphics[width=8.5mm]{magma}\\
  \includegraphics[width=2cm,
                   height=3mm]{magma}
\end{center}
\end{verbatim}
\end{codelist}

\subsubsection{旋转}

如果你希望，可以使用选项\dm{option}来让旋转图片。语法如下：

\begin{dmd}
angle=\codereplace{角}
\end{dmd}

其中\codereplace{角}以角度为单位，以逆时针方向为正方向。

\begin{codelist}[5.4]{
\includegraphics[angle=45,
                 scale=0.2]{img/magma}
}\begin{verbatim}
\includegraphics[angle=45,
                 scale=0.2]{magma}
\end{verbatim}
\end{codelist}

我们可以在文件\dm{grfguide.pdf}\jz{
  可以使用\dm{locate}或\dm{find}在你的系统中找到。
}中找到有关此扩展的详细描述，也可以参阅文档\dm{fepslatex.pdf}\jz{
  \wz{http://tug.ctan.org/tex-archive/info/epslatex/french/fepslatex.pdf}。
}。

\subsubsection{草稿模式}

选项\dm{draft}可以将图片生成为\emph{草稿}模式，即在最终文档中仅生成带有被包含文件文件名的方框。

\begin{codelist}[5.5]{
前前
\includegraphics[draft,scale=.2]{punch}
后后。
}\begin{verbatim}
前前
\includegraphics[draft,scale=.2]{punch}
后后。
\end{verbatim}
\end{codelist}

模式\dm{draft}默认在文档选项\dm{draft}指定时启用。如果想要阻止文档选项的转中效果\jz{
  例如，你希望同时看到图像和“字盒Overfull标记”。
}，可以在使用指令\verb|\includegraphics|或通过\verb|\usepackage|包含扩展时使用选项\dm{final}。

\section{几个实用扩展}

接下来介绍三个可以生成带有图像文档的实用扩展。

\subsection{\textsf{subfig}}

该扩展可以管理带有若干分图的图片，分图会自动编号并能单独引用。例如：

\begin{dmd}
\begin{verbatim}
\begin{figure}[htbp]
  \begin{center}
      \leavevmode \subfloat[Magma]{%
        \label{fig-uniweria-magma}
        \includegraphics[width=2cm]{magma}}
      \hspace{2cm} \subfloat[UZMK]{%
        \label{fig-uniweria-uzmk}
        \includegraphics[height=2cm]{uzmk}}
    \caption{Uniweria Zëkt}
    \label{fig-uniweria}
  \end{center}
\end{figure}
\end{verbatim}
\end{dmd}

\begin{figure}[htbp]
  \begin{center}
      \leavevmode \subfloat[Magma]{%
        \label{fig-uniweria-magma}
        \includegraphics[width=2cm]{img/magma}}
      \hspace{2cm} \subfloat[UZMK]{%
        \label{fig-uniweria-uzmk}
        \includegraphics[height=2cm]{img/uzmk}}
    \caption{Uniweria Zëkt}
    \label{fig-uniweria}
  \end{center}
\end{figure}

在需要引用时，可以通过\verb|\ref{fig-uniweria}|整体引用该图，结果会展示为\ref{fig-uniweria}，也可以通过对应的标签来引用分图，如使用\verb+\ref{fig-uniweria-magma}+和\verb|\ref{fig-uniweria-uzmk}|的结果分别为\ref{fig-uniweria-magma}和\ref{fig-uniweria-uzmk}。
%注意，分图没有括号。疑似这也是相关标准的来源。

\begin{ii}
有一种优雅的分图管理方法，即将每个分图打包为一个\dm{minipage}。发行版%TODO
附带的文件\dm{subfig.pdf}中说明了如何自定义环境\dm{subfigure}，尤其是处理图题间的空白。
\end{ii}

\subsection{包\textsf{wrapfig}}

包\textsf{wrapfig}提供了环境\dm{wrapfigure}，可以让图片在段落中浮动。此处浮动的含义不同于描述\LaTeX 的环境\dm{figure}时所用的浮动，因为此处的环境可以穿插在段落内。语法如下：

\begin{dmd}
\verb|\begin{wrapfigure}{|\codereplace{位置}\}\{\codereplace{宽度}\}\\
...\\
\verb|\end{wrapfigure}|
\end{dmd}

其中\codereplace{位置}即图片的位置（\dm{l}或\dm{r}），\codereplace{宽度}即要插入的图片宽度。如下所示。

