\chapter{装饰}

\begin{quote}
    我说，我要上这棕树，抓住枝子。愿你的两乳好像葡萄累累下垂，你鼻子的气味香如苹果。你的口如上好的酒，女子说，为我的良人下咽舒畅，流入睡觉人的嘴中。

    \hfill《圣经·雅歌》7:10
\end{quote}

那本章的主要思路是介绍，介绍那些为生成文档中个别部分而被个性化修改的\LaTeX 的标准工具，间或可以从中看到些用于“调香”的宏。这些个性化设置可以应用于各个层级：使用包的选项，如设置页眉；偶尔涉足宏定义，如设置章节的展现风格；更深入地处理宏，如处理内容的表格。本章的一部分聚焦于我们可以从包\textsf{fancyvrb}中调用的工具。作为本章的末尾，我们会去抨击一下法文的引号。

\section{索引的外观} % 这节翻译得是什么破玩意

为了修改索引的外观，需要明白，当我们大手一挥噼里啪啦地写下如下指令的时候，我们实际上就生成了一个文件\codereplace{文档}\dm{.ind}：

\dmh{makeindex }\codereplace{文档}

该文件包含了类似下面列出的内容：

\begin{dmd}
\verb|\begin{theindex}| \quad$\leftarrow$\textsf{文前部分}\\
~\\
\verb|\item Cosmic debris, 12,34|\\
~\\
\verb|\indexspace| \quad$\leftarrow$\textsf{分组间的空间}\\
~\\
\verb|\item Debra kadabra, 23| \quad$\leftarrow$\textsf{入口，分割符，页码}\\
~\\
\verb|\end{theindex}| \quad$\leftarrow$\textsf{文后部分}
\end{dmd}

实际上，该代码会从带有预定义值且可被修改的一般性实体中生成。为了证明这个观点，只需要知道，程序\textsf{makeindex}可以生成一个包含\LaTeX 代码外内容的\dm{.ind}文件。为了理解一般性实体的职责，可以用如下方式描述\textsf{makeindex}的工作。

\begin{enumerate}
    \item 根据实体\dm{preamble}的值来写入文前部分。
    \item 对于每个\dm{.idm}文件：
    \begin{enumerate}
        \item 写入实体\dm{item\_0}的内容；
        \item 写入入口（本例中为“Cosmic debris”）；
        \item 写入分割符（实体\dm{delin\_0}的值）；
        \item 写入页码。
    \end{enumerate}
    \item 在每个分组的结尾（即首字母切换时），写入实体\dm{group\_skip}的内容；
    \item 根据\dm{postamble}的值写入文后部分。
\end{enumerate}

上述实体的默认值如下：

\begin{center}
    \begin{dmd}
        \begin{tabular}{|l|l|}
            \hline
            preamble & \verb+"\\begin{theindex}\n"+\\
            item\_0 &\verb+"\n \\item"+\\
            delim\_0 & ", "\\
            group\_skip & \verb+"\n\n \\indexspace\n"+\\
            postamble & \verb+"\n\n\\end{theindex}\n"+\\
            \hline
        \end{tabular}
    \end{dmd}
\end{center}

这些值可以使用通常带有后缀名\dm{.ist}的风格文件作为媒介来修改。可以通过以下方式在调用\textsf{makeindex}时使用：

\dmh{makeindex -s \codereplace{风格}.ist \codereplace{文件}}

如此一来，为了生成文档的标题，我们可以一开始就重新定义一二级间的分隔符：

\begin{dmd}
\begin{verbatim}
delim_0 " \\dotfill \ "
delim_1 " \\dotfill \ "
\end{verbatim}
\end{dmd}

我们将默认用于分隔索引入口和页码的逗号替换成了省略号。接下来，通过严谨地阅读\textsf{makeindex}的文档\jz{
    可参见参考文献的实用引用后的提醒。
}，可以注意到要求\textsf{makeindex}为入口组和代表分组的字母间生成空间的礼貌方式如下：

\begin{dmd}
headings\_flag 1
\end{dmd}

这里，代表分组的字母会表示为大写，并且借助实体\dm{heading\_prefix}和\dm{heading\_suffix}的内容框起。无所谓——为了生成我们美丽的带阴影的字盒，我们可以在风格文件中这样写：

\begin{dmd}
\begin{verbatim}
heading_prefix "{\\large\\sffamily\\bfseries\\shadowbox{"
heading_suffix "}\\hfill}\\nopagebreak\n"
\end{verbatim}
\end{dmd}

这段你已经可以看懂的示例内容，就会生成我们需要的字盒。例如对于字母C：

\begin{codelist}[10.1]{
    {\large\sffamily\bfseries%
    \shadowbox{C}\hfil}\nopagebreak
}\begin{verbatim}
{\large\sffamily\bfseries%
    \shadowbox{C}\hfil}\nopagebreak
\end{verbatim}
\end{codelist}

这段指令会被\dm{group\_skip}的内容覆盖掉。而我们稍早前说过，\dm{group\_skip}的默认值是\verb|\indexspace|。在研究了几个月之后\jz{
    开玩笑的。我是想说，只花了几秒……好吧，几分钟。
}，我们成功地在\dm{book.cls}中发现了该指令的定义，并且将分组间空间略微扩大了些：

\begin{dmd}
\renewcommand\indexspace{%
    \par \vskip 20pt plus5pt minus3pt\relax}
\end{dmd}

\begin{ii}
本小节中，我们只是非常简单地看了看makeindex提供的功能。除了在《\LaTeX 伴侣》中能找到的信息，Debian环境下关于此工具的说明书中提供了我们可以定义的一半入口的详尽列表。由P.陈（P. Chen；音译）和M.A.哈林森（M. A. Harrinson）编写的文件\dm{ind.dvi}同样是初学索引自定义的良好开端。
\end{ii}

\section{标题的外观}

在本节，我们会介绍我们修改\LaTeX 标准（篇、章、节等）标题外观的方式。

\subsection{目录中的编号}

作为开始操作目录的前提条件，需要掌握两个计数器：

\begin{enumerate}
    \item \dm{secnumdepth}（英：\emph{section numbering depth}），可以明确文档中标题编号的层级；
    \item \dm{tocdepth}（英：\emph{table of contents depth}），可以定义目录标题的最大层级（或称最大深度）。
\end{enumerate}

为了使用这两个计数器，还需要了解\LaTeX 为各标题连接层级的方法。以下是各标题的层级：

\begin{center}
    \begin{tabular}{|c|r||c|r|}
        \hline
        标题 & 层级 & 标题 & 层级\\
        \hline
        \dm{part} & -1 & & \\
        \dm{chapter}    & 0 & \dm{subsubsection} & 3\\
        \dm{section}    & 1 & \dm{paragraph}     & 4\\
        \dm{subsection} & 2 & \dm{subparagraph}  & 5\\
        \hline
    \end{tabular}
\end{center}

如此一来，将\verb|secnumdepth|赋值为1、将\verb|tocdepth|赋值为2，则可以让标题编号至各\verb|\section|，同时将层级少于\verb|\subsection|的标题插入目录。

\subsection{节和更少的层级}

在\TeX 系统的文件\dm{book.cls}中，我们可以找到如下代码\jz{
    稍微简化了一些……
}：

\begin{dmd}
\begin{verbatim}
\newcommand{\section}{%
    \@startsection%
    {section} % 标题名称
    {1} % 标题层级
    {0pt} % 缩进
    {-3.5ex plus -1ex minus -.2ex}% 段前纵向空间
    {2.3ex plus.2ex}% 段后纵向空间{\normalfont\Large\bfseries}} % 标题外观
\end{verbatim}
\end{dmd}

该段代码定义了节标题的生成方式。可以观察到，指令\verb|\section|调用了指令\verb|\@startsection|，而后者需要6各参数：

\begin{itemize}
    \item 标题名称，如\dm{section}、\dm{subsection}等；
    \item 标题层级，1对应\dm{section}，2对应\dm{subsection}，3对应\dm{subsubsection}，等等；
    \item 缩进；
    \item 标题前的纵向空白；
    \item 标题后的纵向空白；
    \item 用于确定标题本身格式的一系列\emph{声明}。
\end{itemize}

因此，我们可以注意到\LaTeX 默认为类型\dm{book}设定的版式如下。

\begin{itemize}
    \item 无缩进（\dm{0pt}）。
    \item 标题前的纵向空间为\dm{3.5ex}，带有正向\dm{-1ex}和负向\dm{-.2ex}的允差。
    \item 标题后的纵向空间为\dm{2.3ex}，带有正向\dm{.2ex}的允差。可以注意到，如果空间为负，则段落开头会紧接标题，而不会重起一段。
    \item 标题加粗加大，使用“常规”（normal）字体。
\end{itemize}

为了定义本文档使用的标题样式，我们引入三个长度，分别用于\dm{section}、\dm{subsection}、\dm{subsubsection}的缩进：

\begin{dmd}
\begin{verbatim}
\newlength{\sectiontitleindent}
\newlength{\subsectiontitleindent}
\newlength{\subsubsectiontitleindent}
\end{verbatim}
\end{dmd}

长度值如下：

\begin{dmd}
\begin{verbatim}
\setlength{\sectiontitleindent}{-1cm}
\setlength{\subsectiontitleindent}{-.5cm}
\setlength{\subsubsectiontitleindent}{-.25cm}
\end{verbatim}
\end{dmd}

此外，我们为标题还定义了特殊的字体，具体如下：

\begin{dmd}
\begin{verbatim}
\newcommand{\sectionfont}{% 
    \fontencoding{\encodingdefault}% 
    \fontfamily{pag}% \fontseries{bc}%
    \fontshape{n}% \selectfont}
\end{verbatim}
\end{dmd}

该指令可以选用PostScript字体AvantGarde的加粗紧缩版本（参阅9.4节）%TODO 解释中文的使用
。最终，我们使用了以下指令来定义节标题外观：

\begin{dmd}
\begin{verbatim}
\renewcommand{\section}{% 
    \@startsection%
    {section}%
    {1}%
    {\sectiontitleindent}%
    {-3.5ex plus -1ex minus -.2ex}% 
    {2.3ex plus.2ex}% {\sectionfont\Large}}
\end{verbatim}
\end{dmd}

对于更少层级的标题，我们也编写了等价的指令。

\subsection{章}

通过深入研究文件\dm{book.cls}，我们可以找到有关\LaTeX 生成章首内容的信息。

\subsubsection{原则}

在文件\dm{book.cls}中，我们可以找到以下指令：

\begin{dmd}
\begin{verbatim}
\newcommand{\chapter}{% 
    ...
    \thispagestyle{plain}%
    ...
    \secdef\@chapter\@schapter} % 我们感兴趣的行
\end{verbatim}
\end{dmd}

指令\verb|\chapter|本身会调用两个不同的指令：

\begin{enumerate}
    \item \verb|\@chapter|，用于被编号的章标题；
    \item \verb|\@schapter|，用于不被编号的章标题（\dmh{s}代表\emph{star}，即“星号”，对应指令\verb|\chapter*|）。
\end{enumerate}